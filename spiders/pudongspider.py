# -*- coding:utf-8 -*-
import requests
from bs4 import BeautifulSoup
import csv, codecs
import datetime
import sys

reload(sys)
sys.setdefaultencoding('utf-8')

#url_1 = 'http://planning.pudong.gov.cn/WebSite/list.aspx?code=1301'


def get_plan(session, index, count, url):
    data = {
        '__EVENTTARGET': 'ctl00$MainContent$ListPaging1$lbNext',
        '__EVENTARGUMENT': '',
        '__VIEWSTATE': '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',
        '__VIEWSTATEENCRYPTED': '',
        '__EVENTVALIDATION': 'v/pTDgi2rNDLuVHJe9o9+XJXSZErJ6FKUpzwELaM4/Wc3ai6gIfiMThtPfay0ggRw+h+lQGZNmKh6OAKyf9YE/qvjVLcqxoQGmwwd8iIOk5z4sMa/l3dNKKknUOyy4Ow208zyhhLXvwXkPPAf2jH+nsTxUZ8Z7GjP0h4R3zBoJz8odmQary9sxYs3EdfZ9ctwmF3eJmnQyHcovEkJGT2CvMHnCw=',
        'ctl00$MainContent$ListPaging1$txtGO': '',
        'ctl00$MainContent$ListPaging1$hfPageIndex': index,
        'ctl00$MainContent$ListPaging1$hfPageCount': count
    }
    response = session.post(url, data)
    soup = BeautifulSoup(response.text, "html.parser")
    print soup.find('table', class_="newslist_tb")
    return soup


def remove_space_and_line_break_in_string(string):
    if string is not None:
        return string.replace(' ', '').replace('\r\n', '')
    else:
        return ""


def get_plan_detail(soup, csv_write):
    table = soup.find('table', class_="newslist_tb")
    tr_list = table.find_all('tr')
    for tr in tr_list:
        td_list = tr.find_all('td')
        if len(td_list) != 0:
            content = []
            for td in td_list:
                content.append(remove_space_and_line_break_in_string(td.text))
                print "Text: " + remove_space_and_line_break_in_string(td.text)
            csv_write.writerow(content)



count = input("Please input total page count: ")

url = 'http://planning.pudong.gov.cn/WebSite/list.aspx?code=1401'
out = codecs.open('plan.csv', 'a', 'utf_8_sig')
csv_write = csv.writer(out, dialect='excel')

s = requests.session()
for i in range(0, count):
    soup = get_plan(s, i, count, url)
    get_plan_detail(soup, csv_write)
out.close()
